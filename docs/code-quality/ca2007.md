---
title: 'CA2007: Nečekejte přímo na úlohu'
ms.date: 03/08/2019
ms.topic: reference
f1_keywords:
- CA2007
- DoNotDirectlyAwaitATaskAnalyzer
helpviewer_keywords:
- CA2007
author: mikejo5000
ms.author: mikejo
manager: jillfra
dev_langs:
- CSharp
ms.openlocfilehash: f55cc992c443b034ccfbf444db4b3ca705b2b698
ms.sourcegitcommit: 26178b116cbf7353fee6ca989b8d872114f7b405
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 08/31/2020
ms.locfileid: "89219618"
---
# <a name="ca2007-do-not-directly-await-a-task"></a>CA2007: Nečekejte přímo na úlohu

|Položka|Hodnota|
|-|-|
|CheckId|CA2007|
|Kategorie|Microsoft.Reliability|
|Zásadní změna|Nenarušující|

## <a name="cause"></a>Příčina

Asynchronní metoda [čeká](/dotnet/csharp/language-reference/keywords/await) <xref:System.Threading.Tasks.Task> přímo.

## <a name="rule-description"></a>Popis pravidla

Když asynchronní metoda čeká <xref:System.Threading.Tasks.Task> přímo, pokračování probíhá ve stejném vlákně, které vytvořilo úlohu, v závislosti na asynchronním kontextu. Toto chování může být nákladné v souvislosti s výkonem a může způsobit zablokování ve vlákně uživatelského rozhraní. Zvažte volání <xref:System.Threading.Tasks.Task.ConfigureAwait(System.Boolean)?displayProperty=nameWithType> , abyste vyvolali svůj záměr na pokračování.

## <a name="how-to-fix-violations"></a>Jak opravit porušení

Chcete-li opravit porušení, zavolejte <xref:System.Threading.Tasks.Task.ConfigureAwait%2A> na očekáváno <xref:System.Threading.Tasks.Task> . Pro parametr můžete předat buď `true` nebo `false` `continueOnCapturedContext` .

- Volání `ConfigureAwait(true)` na úlohu má stejné chování jako neexplicitní volání <xref:System.Threading.Tasks.Task.ConfigureAwait%2A> . Explicitním voláním této metody umožníte čtenářům, aby měli v úmyslu provést pokračování v původním kontextu synchronizace.

- Zavolejte `ConfigureAwait(false)` na úkol pro naplánování pokračování fondu vláken, čímž se vyhnete zablokování vlákna uživatelského rozhraní. Předávání `false` je vhodné pro knihovny nezávislé na aplikaci.

## <a name="when-to-suppress-warnings"></a>Kdy potlačit upozornění

Toto upozornění je určené pro knihovny, kde kód může být spuštěn v libovolném prostředí a kde kód by neměl vytvářet předpoklady pro prostředí nebo způsob, jakým volající metoda může vystavit nebo čekat na něj. Obecně je vhodné potlačit upozornění zcela pro projekty, které reprezentují kód aplikace namísto kódu knihovny; ve skutečnosti, že spuštění tohoto analyzátoru v kódu aplikace (například obslužné rutiny události kliknutí na tlačítko v projektu WinForms nebo WPF) může vést k nesprávným akcím.

Toto upozornění můžete potlačit v jakékoli situaci, kdy by mělo být pokračování naplánováno zpět do původního kontextu nebo pokud neexistuje žádný takový kontext. Například při psaní kódu v obslužné rutině události kliknutí na tlačítko v aplikaci pro WinForms nebo WPF by obecně mělo běžet pokračování z funkce await ve vlákně uživatelského rozhraní, a proto je žádoucí výchozí chování plánování pokračování zpět na původní kontext. V jiném příkladu při psaní kódu v ASP.NET Core aplikaci, ve výchozím nastavení neexistuje žádný <xref:System.Threading.SynchronizationContext> nebo <xref:System.Threading.Tasks.TaskScheduler> , pro který by nedošlo ke `ConfigureAwait` změně chování.

## <a name="example"></a>Příklad

Následující fragment kódu vygeneruje upozornění:

```csharp
public async Task Execute()
{
    Task task = null;
    await task;
}
```

Chcete-li opravit porušení, zavolejte <xref:System.Threading.Tasks.Task.ConfigureAwait%2A> na očekávaný <xref:System.Threading.Tasks.Task> :

```csharp
public async Task Execute()
{
    Task task = null;
    await task.ConfigureAwait(false);
}
```

## <a name="configurability"></a>Konfigurovatelnost

Můžete nakonfigurovat, zda chcete vyloučit asynchronní metody, které nevracejí hodnotu z tohoto pravidla. Chcete-li vyloučit tyto druhy metod, přidejte do souboru. editorconfig v projektu následující dvojici klíč-hodnota:

```ini
# Package version 2.9.0 and later
dotnet_code_quality.CA2007.exclude_async_void_methods = true

# Package version 2.6.3 and earlier
dotnet_code_quality.CA2007.skip_async_void_methods = true
```

Můžete také nakonfigurovat, na které výstupní typy sestavení se má toto pravidlo použít. Chcete-li například použít toto pravidlo pouze na kód, který vytvoří konzolovou aplikaci nebo dynamicky propojenou knihovnu (tj. není to aplikace uživatelského rozhraní), přidejte do souboru. editorconfig v projektu následující dvojici klíč-hodnota:

```ini
dotnet_code_quality.CA2007.output_kind = ConsoleApplication, DynamicallyLinkedLibrary
```

Další informace najdete v tématu [Konfigurace analyzátorů kvality kódu .NET](configure-fxcop-analyzers.md).

## <a name="see-also"></a>Viz také

- [Nejčastější dotazy k ConfigureAwait](https://devblogs.microsoft.com/dotnet/configureawait-faq/)
- [Mám očekávat úlohu s ConfigureAwait (NEPRAVDA)?](https://github.com/Microsoft/vs-threading/blob/master/doc/cookbook_vs.md#should-i-await-a-task-with-configureawaitfalse)
- [CA2008: Nevytvářejte úlohy bez předávání TaskScheduler](ca2008.md)
- [Upozornění spolehlivosti](reliability-warnings.md)
