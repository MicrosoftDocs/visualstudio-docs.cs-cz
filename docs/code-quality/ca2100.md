---
title: 'CA2100: Zkontrolujte chyby zabezpečení u dotazů SQL'
ms.date: 11/04/2016
ms.topic: reference
f1_keywords:
- Review SQL queries for security vulnerabilities
- ReviewSqlQueriesForSecurityVulnerabilities
- CA2100
helpviewer_keywords:
- CA2100
- ReviewSqlQueriesForSecurityVulnerabilities
ms.assetid: 79670604-c02a-448d-9c0e-7ea0120bc5fe
author: mikejo5000
ms.author: mikejo
manager: jillfra
dev_langs:
- CSharp
- VB
ms.workload:
- multiple
ms.openlocfilehash: fc76841f7a43f8ed9962a844b396d1f36aa2df88
ms.sourcegitcommit: 6cfffa72af599a9d667249caaaa411bb28ea69fd
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 09/02/2020
ms.locfileid: "88709438"
---
# <a name="ca2100-review-sql-queries-for-security-vulnerabilities"></a>CA2100: Zkontrolujte chyby zabezpečení u dotazů SQL

|Položka|Hodnota|
|-|-|
|CheckId|CA2100|
|Kategorie|Microsoft.Security|
|Zásadní změna|Nenarušující|

## <a name="cause"></a>Příčina

Metoda nastavuje <xref:System.Data.IDbCommand.CommandText%2A?displayProperty=fullName> vlastnost pomocí řetězce, který je sestaven z řetězcového argumentu metody.

Ve výchozím nastavení toto pravidlo analyzuje celý základ kódu, ale je možné ho [nakonfigurovat](#configurability).

## <a name="rule-description"></a>Popis pravidla

Toto pravidlo předpokládá, že libovolný řetězec, jehož hodnotu nelze určit v době kompilace, může obsahovat vstup uživatele. Řetězec příkazu SQL sestavený ze vstupu uživatele je ohrožen útoky prostřednictvím injektáže SQL. V případě útoku prostřednictvím injektáže SQL uživatel se zlými úmysly dodává vstup, který mění návrh dotazu při pokusu o poškození nebo získání neoprávněného přístupu k podkladové databázi. Mezi obvyklé techniky patří vložení jednoduché uvozovky nebo apostrofu, což je oddělovač řetězcového literálu SQL. dvě pomlčky, což znamená komentář SQL; a středníkem, který indikuje, že následuje nový příkaz. Pokud musí být vstup uživatele součástí dotazu, použijte jednu z následujících možností, která je uvedena v řádu účinnosti, aby se snížilo riziko útoku.

- Použijte uloženou proceduru.

- Použijte parametrizovaný řetězec příkazu.

- Před sestavením řetězce příkazu ověřte vstup uživatele pro typ i obsah.

Následující typy rozhraní .NET implementují <xref:System.Data.IDbCommand.CommandText%2A> vlastnost nebo poskytují konstruktory, které nastavily vlastnost pomocí řetězcového argumentu.

- <xref:System.Data.Odbc.OdbcCommand?displayProperty=fullName> a <xref:System.Data.Odbc.OdbcDataAdapter?displayProperty=fullName>

- <xref:System.Data.OleDb.OleDbCommand?displayProperty=fullName> a <xref:System.Data.OleDb.OleDbDataAdapter?displayProperty=fullName>

- <xref:System.Data.OracleClient.OracleCommand?displayProperty=fullName> a <xref:System.Data.OracleClient.OracleDataAdapter?displayProperty=fullName>

- <xref:System.Data.SqlClient.SqlCommand?displayProperty=fullName> a <xref:System.Data.SqlClient.SqlDataAdapter?displayProperty=fullName>

V některých případech toto pravidlo nemusí určovat hodnotu řetězce v době kompilace, i když můžete. V těchto případech toto pravidlo při použití těchto řetězců jako příkazů SQL vytvoří falešně pozitivní výsledky. Následuje příklad takového řetězce.

```csharp
int x = 10;
string query = "SELECT TOP " + x.ToString() + " FROM Table";
```

Totéž platí při `ToString()` implicitním použití.

```csharp
int x = 10;
string query = String.Format("SELECT TOP {0} FROM Table", x);
```

## <a name="how-to-fix-violations"></a>Jak opravit porušení

Chcete-li opravit porušení tohoto pravidla, použijte parametrizovaný dotaz.

## <a name="when-to-suppress-warnings"></a>Kdy potlačit upozornění

Pokud text příkazu neobsahuje žádný vstup uživatele, je bezpečné potlačit upozornění od tohoto pravidla.

## <a name="configurability"></a>Konfigurovatelnost

Toto pravidlo má následující konfigurovatelné možnosti.

### <a name="excluded-symbol-names"></a>Vyloučené názvy symbolů

Můžete nakonfigurovat, které části vašeho základu kódu budou vyloučeny z analýzy. Například chcete-li určit, že pravidlo by nemělo běžet pro žádný kód v rámci typů s názvem `MyType` , přidejte do souboru. editorconfig v projektu následující dvojici klíč-hodnota:

```ini
dotnet_code_quality.CA2100.excluded_symbol_names = MyType
```

Povolené formáty názvů symbolů v hodnotě možnosti (oddělené |):
- Pouze název symbolu (včetně všech symbolů s názvem, bez ohledu na obsahující typ nebo obor názvů)
- Plně kvalifikované názvy ve [formátu ID dokumentace k](https://github.com/dotnet/csharplang/blob/master/spec/documentation-comments.md#id-string-format)symbolu. Každý název symbolu vyžaduje předponu typu symbolu, jako je například "M:" prefix pro metody, předpona "T:" pro typy, předpona "N:" pro obory názvů atd.
- `.ctor` pro konstruktory a `.cctor` pro statické konstruktory

Příklady:

| Hodnota možnosti | Shrnutí |
| --- | --- |
|`dotnet_code_quality.CA2100.excluded_symbol_names = MyType` | Odpovídá všem symbolům s názvem ' MyType ' v kompilaci
|`dotnet_code_quality.CA2100.excluded_symbol_names = MyType1|MyType2` | Odpovídá všem symbolům s názvem ' MyType1 ' nebo ' MyType2 ' v kompilaci
|`dotnet_code_quality.CA2100.excluded_symbol_names = M:NS.MyType.MyMethod(ParamType)` | Odpovídá konkrétní metodě ' MyMethod ' s daným plně kvalifikovaným podpisem
|`dotnet_code_quality.CA2100.excluded_symbol_names = M:NS1.MyType1.MyMethod1(ParamType)|M:NS2.MyType2.MyMethod2(ParamType)` | Odpovídá specifickým metodám ' MyMethod1 ' a ' MyMethod2 ' s odpovídajícím plně kvalifikovaným podpisem

Všechny tyto možnosti můžete nakonfigurovat jenom pro toto pravidlo, pro všechna pravidla nebo pro všechna pravidla v této kategorii (zabezpečení). Další informace najdete v tématu [Konfigurace analyzátorů kvality kódu .NET](configure-fxcop-analyzers.md).

## <a name="example"></a>Příklad

Následující příklad ukazuje metodu,, `UnsafeQuery` která porušuje pravidlo a metodu, `SaferQuery` ,, který splňuje pravidlo pomocí parametrizovaného řetězce příkazu.

[!code-vb[FxCop.Security.ReviewSqlQueries#1](../code-quality/codesnippet/VisualBasic/ca2100-review-sql-queries-for-security-vulnerabilities_1.vb)]
[!code-csharp[FxCop.Security.ReviewSqlQueries#1](../code-quality/codesnippet/CSharp/ca2100-review-sql-queries-for-security-vulnerabilities_1.cs)]

## <a name="see-also"></a>Viz také

- [Přehled zabezpečení](/dotnet/framework/data/adonet/security-overview)
