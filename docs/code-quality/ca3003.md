---
title: 'CA3003: Zkontrolujte ohrožení zabezpečení injektáží cesty k souboru v kódu'
ms.date: 04/03/2019
ms.topic: reference
author: dotpaul
ms.author: paulming
manager: jillfra
dev_langs:
- CSharp
- VB
ms.workload:
- multiple
ms.openlocfilehash: f685dfecbcf32fa9e8346a84c94e1039f2619f3a
ms.sourcegitcommit: 6cfffa72af599a9d667249caaaa411bb28ea69fd
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 09/02/2020
ms.locfileid: "88707202"
---
# <a name="ca3003-review-code-for-file-path-injection-vulnerabilities"></a>CA3003: Zkontrolujte ohrožení zabezpečení injektáží cesty k souboru v kódu

|Položka|Hodnota|
|-|-|
|CheckId|CA3003|
|Kategorie|Microsoft.Security|
|Zásadní změna|Nenarušující|

## <a name="cause"></a>Příčina

Potenciálně nedůvěryhodný vstup požadavku HTTP dosáhne cesty operace se souborem.

Ve výchozím nastavení toto pravidlo analyzuje celý základ kódu, ale je možné ho [nakonfigurovat](#configurability).

## <a name="rule-description"></a>Popis pravidla

Při práci s nedůvěryhodným vstupem z webových požadavků nezapomeňte při zadávání cest k souborům použít vstup, který je řízený uživatelem. Útočník může číst nezamýšlený soubor, což má za následek zpřístupnění citlivých dat. Nebo může útočník zapisovat do nezamýšleného souboru, což by způsobilo neoprávněnou úpravu citlivých dat nebo narušit zabezpečení serveru. Běžný technik útočníka je [procházení cest](https://www.owasp.org/index.php/Path_Traversal) pro přístup k souborům mimo určený adresář.

Toto pravidlo se pokouší najít vstup z požadavků HTTP, které dosáhly cesty v operaci souboru.

> [!NOTE]
> Toto pravidlo nemůže sledovat data napříč sestaveními. Například pokud jedno sestavení přečte vstup požadavku HTTP a pak ho předává do jiného sestavení, které zapisuje do souboru, toto pravidlo nevytvoří upozornění.

> [!NOTE]
> Existuje konfigurovatelné omezení, jak hluboko bude toto pravidlo analyzovat tok dat napříč voláními metod. Postup konfigurace limitu v souboru EditorConfig naleznete v tématu [Configuration Analyzer](https://github.com/dotnet/roslyn-analyzers/blob/master/docs/Analyzer%20Configuration.md#dataflow-analysis) .

## <a name="how-to-fix-violations"></a>Jak opravit porušení

- Pokud je to možné, omezte cesty k souborům na základě vstupu uživatele na explicitně známý bezpečný seznam.  Například pokud vaše aplikace potřebuje přístup k "red.txt", "green.txt" nebo "blue.txt", povolte pouze tyto hodnoty.
- Zkontrolujte nedůvěryhodné názvy souborů a ověřte, zda je název správně vytvořen.
- Při zadávání cest Používejte názvy úplných cest.
- Vyhněte se potenciálně nebezpečným konstrukcím, jako jsou proměnné prostředí PATH.
- Akceptuje pouze dlouhé názvy souborů a ověří dlouhé jméno, pokud uživatel odesílá krátké názvy.
- Omezí vstup koncového uživatele na platné znaky.
- Zamítnout jména, kde se překročila MAX_PATH délka
- Zpracuje názvy souborů doslova bez interpretace.
- Určete, zda název souboru představuje soubor nebo zařízení.

## <a name="when-to-suppress-warnings"></a>Kdy potlačit upozornění

Pokud jste ověřili vstup, jak je popsáno v předchozí části, je to v pořádku, abyste toto upozornění potlačili.

## <a name="configurability"></a>Konfigurovatelnost

Toto pravidlo má následující konfigurovatelné možnosti.

### <a name="excluded-symbol-names"></a>Vyloučené názvy symbolů

Můžete nakonfigurovat, které části vašeho základu kódu budou vyloučeny z analýzy. Například chcete-li určit, že pravidlo by nemělo běžet pro žádný kód v rámci typů s názvem `MyType` , přidejte do souboru. editorconfig v projektu následující dvojici klíč-hodnota:

```ini
dotnet_code_quality.CA3003.excluded_symbol_names = MyType
```

Povolené formáty názvů symbolů v hodnotě možnosti (oddělené |):
- Pouze název symbolu (včetně všech symbolů s názvem, bez ohledu na obsahující typ nebo obor názvů)
- Plně kvalifikované názvy ve [formátu ID dokumentace k](https://github.com/dotnet/csharplang/blob/master/spec/documentation-comments.md#id-string-format)symbolu. Každý název symbolu vyžaduje předponu typu symbolu, jako je například "M:" prefix pro metody, předpona "T:" pro typy, předpona "N:" pro obory názvů atd.
- `.ctor` pro konstruktory a `.cctor` pro statické konstruktory

Příklady:

| Hodnota možnosti | Shrnutí |
| --- | --- |
|`dotnet_code_quality.CA3003.excluded_symbol_names = MyType` | Odpovídá všem symbolům s názvem ' MyType ' v kompilaci
|`dotnet_code_quality.CA3003.excluded_symbol_names = MyType1|MyType2` | Odpovídá všem symbolům s názvem ' MyType1 ' nebo ' MyType2 ' v kompilaci
|`dotnet_code_quality.CA3003.excluded_symbol_names = M:NS.MyType.MyMethod(ParamType)` | Odpovídá konkrétní metodě ' MyMethod ' s daným plně kvalifikovaným podpisem
|`dotnet_code_quality.CA3003.excluded_symbol_names = M:NS1.MyType1.MyMethod1(ParamType)|M:NS2.MyType2.MyMethod2(ParamType)` | Odpovídá specifickým metodám ' MyMethod1 ' a ' MyMethod2 ' s odpovídajícím plně kvalifikovaným podpisem

Všechny tyto možnosti můžete nakonfigurovat jenom pro toto pravidlo, pro všechna pravidla nebo pro všechna pravidla v této kategorii (zabezpečení). Další informace najdete v tématu [Konfigurace analyzátorů kvality kódu .NET](configure-fxcop-analyzers.md).

## <a name="pseudo-code-examples"></a>Příklady kódu pseudo

### <a name="violation"></a>Selhání

```csharp
using System;
using System.IO;

public partial class WebForm : System.Web.UI.Page
{
    protected void Page_Load(object sender, EventArgs e)
    {
        string userInput = Request.Params["UserInput"];
        // Assume the following directory structure:
        //   wwwroot\currentWebDirectory\user1.txt
        //   wwwroot\currentWebDirectory\user2.txt
        //   wwwroot\secret\allsecrets.txt
        // There is nothing wrong if the user inputs:
        //   user1.txt
        // However, if the user input is:
        //   ..\secret\allsecrets.txt
        // Then an attacker can now see all the secrets.

        // Avoid this:
        using (File.Open(userInput, FileMode.Open))
        {
            // Read a file with the name supplied by user
            // Input through request's query string and display
            // The content to the webpage.
        }
    }
}
```

```vb
Imports System
Imports System.IO

Partial Public Class WebForm
    Inherits System.Web.UI.Page

    Protected Sub Page_Load(sender As Object, e As EventArgs)
        Dim userInput As String = Me.Request.Params("UserInput")
        ' Assume the following directory structure:
        '   wwwroot\currentWebDirectory\user1.txt
        '   wwwroot\currentWebDirectory\user2.txt
        '   wwwroot\secret\allsecrets.txt
        ' There is nothing wrong if the user inputs:
        '   user1.txt
        ' However, if the user input is:
        '   ..\secret\allsecrets.txt
        ' Then an attacker can now see all the secrets.

        ' Avoid this:
        Using File.Open(userInput, FileMode.Open)
            ' Read a file with the name supplied by user
            ' Input through request's query string and display
            ' The content to the webpage.
        End Using
    End Sub
End Class
```
